<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis热key,缓存穿透,击穿,集群等问题研究 | 心谭博客</title>
    <meta name="description" content="用心，谈技术。已有前端知识体系梳理、设计模式手册、Webpack4教程，欢迎食用">
    
    
    <link rel="preload" href="/assets/css/0.styles.1bd072d0.css" as="style"><link rel="preload" href="/assets/js/app.11f385e3.js" as="script"><link rel="preload" href="/assets/js/2.f7ad212a.js" as="script"><link rel="preload" href="/assets/js/128.00be12cd.js" as="script"><link rel="preload" href="/assets/js/4.6e2c4845.js" as="script"><link rel="prefetch" href="/assets/js/10.7bb17bea.js"><link rel="prefetch" href="/assets/js/100.64c74779.js"><link rel="prefetch" href="/assets/js/101.5569141d.js"><link rel="prefetch" href="/assets/js/102.4ddaecaa.js"><link rel="prefetch" href="/assets/js/103.fe562f89.js"><link rel="prefetch" href="/assets/js/104.0d707d60.js"><link rel="prefetch" href="/assets/js/105.976c7869.js"><link rel="prefetch" href="/assets/js/106.4ca01bc1.js"><link rel="prefetch" href="/assets/js/107.7978e124.js"><link rel="prefetch" href="/assets/js/108.fd979949.js"><link rel="prefetch" href="/assets/js/109.5db8355d.js"><link rel="prefetch" href="/assets/js/11.1ba833f5.js"><link rel="prefetch" href="/assets/js/110.b9e76335.js"><link rel="prefetch" href="/assets/js/111.5541a078.js"><link rel="prefetch" href="/assets/js/112.83d614fe.js"><link rel="prefetch" href="/assets/js/113.4897ac1a.js"><link rel="prefetch" href="/assets/js/114.cb2e71b0.js"><link rel="prefetch" href="/assets/js/115.ba6f5b28.js"><link rel="prefetch" href="/assets/js/116.4c317525.js"><link rel="prefetch" href="/assets/js/117.7513f9ab.js"><link rel="prefetch" href="/assets/js/118.ba13e079.js"><link rel="prefetch" href="/assets/js/119.00e81600.js"><link rel="prefetch" href="/assets/js/12.8c8a7608.js"><link rel="prefetch" href="/assets/js/120.6c02ad55.js"><link rel="prefetch" href="/assets/js/121.de4fe5a6.js"><link rel="prefetch" href="/assets/js/122.69f38ebf.js"><link rel="prefetch" href="/assets/js/123.85246bc1.js"><link rel="prefetch" href="/assets/js/124.22ce8f82.js"><link rel="prefetch" href="/assets/js/125.4eeb3b1b.js"><link rel="prefetch" href="/assets/js/126.4be82d9c.js"><link rel="prefetch" href="/assets/js/127.a6c64cc4.js"><link rel="prefetch" href="/assets/js/129.82b8132e.js"><link rel="prefetch" href="/assets/js/13.c680b753.js"><link rel="prefetch" href="/assets/js/130.cb970a77.js"><link rel="prefetch" href="/assets/js/131.4c048f68.js"><link rel="prefetch" href="/assets/js/132.9a40d44a.js"><link rel="prefetch" href="/assets/js/133.a00a454f.js"><link rel="prefetch" href="/assets/js/134.9bd69275.js"><link rel="prefetch" href="/assets/js/135.9935d41c.js"><link rel="prefetch" href="/assets/js/136.a64e860d.js"><link rel="prefetch" href="/assets/js/137.d8e463bf.js"><link rel="prefetch" href="/assets/js/138.b57949c0.js"><link rel="prefetch" href="/assets/js/139.be3ebe07.js"><link rel="prefetch" href="/assets/js/14.f35337f7.js"><link rel="prefetch" href="/assets/js/140.2aaae4ec.js"><link rel="prefetch" href="/assets/js/141.0c57a923.js"><link rel="prefetch" href="/assets/js/142.dded91f3.js"><link rel="prefetch" href="/assets/js/143.ff8c7911.js"><link rel="prefetch" href="/assets/js/144.6efc44dc.js"><link rel="prefetch" href="/assets/js/145.0c677c9e.js"><link rel="prefetch" href="/assets/js/146.79d22e51.js"><link rel="prefetch" href="/assets/js/147.aed09a5e.js"><link rel="prefetch" href="/assets/js/148.64876089.js"><link rel="prefetch" href="/assets/js/149.67b40f93.js"><link rel="prefetch" href="/assets/js/15.2f12d8e4.js"><link rel="prefetch" href="/assets/js/16.119da7ac.js"><link rel="prefetch" href="/assets/js/17.8104969d.js"><link rel="prefetch" href="/assets/js/18.c55fd566.js"><link rel="prefetch" href="/assets/js/19.4c86a9dc.js"><link rel="prefetch" href="/assets/js/20.4b78e4e4.js"><link rel="prefetch" href="/assets/js/21.1688cb2e.js"><link rel="prefetch" href="/assets/js/22.d29292ff.js"><link rel="prefetch" href="/assets/js/23.669b0340.js"><link rel="prefetch" href="/assets/js/24.9275ec5c.js"><link rel="prefetch" href="/assets/js/25.b788b6d5.js"><link rel="prefetch" href="/assets/js/26.76b06c84.js"><link rel="prefetch" href="/assets/js/27.0a79c2ff.js"><link rel="prefetch" href="/assets/js/28.dcacfa8e.js"><link rel="prefetch" href="/assets/js/29.12e25124.js"><link rel="prefetch" href="/assets/js/3.266f36de.js"><link rel="prefetch" href="/assets/js/30.459aa17c.js"><link rel="prefetch" href="/assets/js/31.514ee4b3.js"><link rel="prefetch" href="/assets/js/32.2028cca5.js"><link rel="prefetch" href="/assets/js/33.80154e3f.js"><link rel="prefetch" href="/assets/js/34.6f47a1b2.js"><link rel="prefetch" href="/assets/js/35.49e29f4d.js"><link rel="prefetch" href="/assets/js/36.d599d08b.js"><link rel="prefetch" href="/assets/js/37.47bdd17a.js"><link rel="prefetch" href="/assets/js/38.b10a8cf4.js"><link rel="prefetch" href="/assets/js/39.229a3cfa.js"><link rel="prefetch" href="/assets/js/40.257f0b89.js"><link rel="prefetch" href="/assets/js/41.ff4dabd5.js"><link rel="prefetch" href="/assets/js/42.6ff66b5c.js"><link rel="prefetch" href="/assets/js/43.64229001.js"><link rel="prefetch" href="/assets/js/44.cff78f8e.js"><link rel="prefetch" href="/assets/js/45.5544a822.js"><link rel="prefetch" href="/assets/js/46.8c004c87.js"><link rel="prefetch" href="/assets/js/47.e2814f56.js"><link rel="prefetch" href="/assets/js/48.9b675c72.js"><link rel="prefetch" href="/assets/js/49.f9cfc7a5.js"><link rel="prefetch" href="/assets/js/5.c3c7bb36.js"><link rel="prefetch" href="/assets/js/50.e5555640.js"><link rel="prefetch" href="/assets/js/51.a3ffe01b.js"><link rel="prefetch" href="/assets/js/52.ef003cd9.js"><link rel="prefetch" href="/assets/js/53.05017dcb.js"><link rel="prefetch" href="/assets/js/54.da68d346.js"><link rel="prefetch" href="/assets/js/55.44e02511.js"><link rel="prefetch" href="/assets/js/56.052c5b22.js"><link rel="prefetch" href="/assets/js/57.a784c964.js"><link rel="prefetch" href="/assets/js/58.7b765fdb.js"><link rel="prefetch" href="/assets/js/59.8fb85d2d.js"><link rel="prefetch" href="/assets/js/6.457336c3.js"><link rel="prefetch" href="/assets/js/60.4b1dad5c.js"><link rel="prefetch" href="/assets/js/61.ad22cb00.js"><link rel="prefetch" href="/assets/js/62.8c33e343.js"><link rel="prefetch" href="/assets/js/63.50fba121.js"><link rel="prefetch" href="/assets/js/64.77da0c33.js"><link rel="prefetch" href="/assets/js/65.ba56942e.js"><link rel="prefetch" href="/assets/js/66.1141b34e.js"><link rel="prefetch" href="/assets/js/67.e3eeca4c.js"><link rel="prefetch" href="/assets/js/68.455dedfb.js"><link rel="prefetch" href="/assets/js/69.b3efa644.js"><link rel="prefetch" href="/assets/js/7.6b9310fb.js"><link rel="prefetch" href="/assets/js/70.1f59c534.js"><link rel="prefetch" href="/assets/js/71.81f44ed1.js"><link rel="prefetch" href="/assets/js/72.04dc0efb.js"><link rel="prefetch" href="/assets/js/73.16bb8119.js"><link rel="prefetch" href="/assets/js/74.f1cf6db9.js"><link rel="prefetch" href="/assets/js/75.4da1044c.js"><link rel="prefetch" href="/assets/js/76.eff4e1d7.js"><link rel="prefetch" href="/assets/js/77.a5fcad5a.js"><link rel="prefetch" href="/assets/js/78.3369114f.js"><link rel="prefetch" href="/assets/js/79.ca5feb63.js"><link rel="prefetch" href="/assets/js/8.5f5a2aca.js"><link rel="prefetch" href="/assets/js/80.dd0a751d.js"><link rel="prefetch" href="/assets/js/81.061294ea.js"><link rel="prefetch" href="/assets/js/82.8256fe22.js"><link rel="prefetch" href="/assets/js/83.c85b51b6.js"><link rel="prefetch" href="/assets/js/84.69e66e82.js"><link rel="prefetch" href="/assets/js/85.4ba31ebd.js"><link rel="prefetch" href="/assets/js/86.38d375e7.js"><link rel="prefetch" href="/assets/js/87.07434971.js"><link rel="prefetch" href="/assets/js/88.60a61751.js"><link rel="prefetch" href="/assets/js/89.6cd6a045.js"><link rel="prefetch" href="/assets/js/9.cd8f5827.js"><link rel="prefetch" href="/assets/js/90.6b0f6cac.js"><link rel="prefetch" href="/assets/js/91.ac1f2cc8.js"><link rel="prefetch" href="/assets/js/92.c19b1955.js"><link rel="prefetch" href="/assets/js/93.bf354a69.js"><link rel="prefetch" href="/assets/js/94.4ae92256.js"><link rel="prefetch" href="/assets/js/95.c0055a85.js"><link rel="prefetch" href="/assets/js/96.0da127d1.js"><link rel="prefetch" href="/assets/js/97.5846a48a.js"><link rel="prefetch" href="/assets/js/98.23965f2b.js"><link rel="prefetch" href="/assets/js/99.ef093a59.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1bd072d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">心谭博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">最新</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-03-26-javascript-first/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-09-es6/" class="nav-link">ES6</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-10-html5-drag-drop/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-15-browser/" class="nav-link">浏览器与安全</a></li></ul></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-14-game-gomoku/" class="nav-link">云开发技术</a></li><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-05-07-play-node-shell/" class="nav-link">命令行交互</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-04-jest-base/" class="nav-link">测试</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-02-node-block-chain/" class="nav-link">源码探索</a></li></ul></li><li class="dropdown-item"><h4>框架工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-07-29-webpack-demos-introduction/" class="nav-link">Webpack4教程</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-08-react-components-communication/" class="nav-link">开发实战</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">UI设计</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2018-06-05-border-sizing/" class="nav-link">CSS3</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-17-why-i-stopped-using-sass/" class="nav-link">SCSS</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-07-16-font-animation/" class="nav-link">动画设计</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-09-09-mysql-blog-ui/" class="nav-link">项目实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-06-23-algorithm-offer/" class="nav-link">JS版·剑指offer</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-10-23-singleton-pattern/" class="nav-link">创建型模式</a></li><li class="dropdown-subitem"><a href="/passages/2018-12-16-flyweight-pattern/" class="nav-link">结构型模式</a></li><li class="dropdown-subitem"><a href="/passages/2018-11-25-command-pattern/" class="nav-link">行为型模式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-10-weekly-share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-09-06-git-tag-and-version/" class="nav-link">Git手册</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/together/" class="nav-link">参与协作</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">网站信息</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-07-12-redis-cache-question/" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">最新</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">大前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-03-26-javascript-first/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-09-es6/" class="nav-link">ES6</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-10-html5-drag-drop/" class="nav-link">HTML5</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-15-browser/" class="nav-link">浏览器与安全</a></li></ul></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-14-game-gomoku/" class="nav-link">云开发技术</a></li><li class="dropdown-item"><h4>Node</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-05-07-play-node-shell/" class="nav-link">命令行交互</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-04-jest-base/" class="nav-link">测试</a></li><li class="dropdown-subitem"><a href="/passages/2019-05-02-node-block-chain/" class="nav-link">源码探索</a></li></ul></li><li class="dropdown-item"><h4>框架工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-07-29-webpack-demos-introduction/" class="nav-link">Webpack4教程</a></li><li class="dropdown-subitem"><a href="/passages/2019-04-08-react-components-communication/" class="nav-link">开发实战</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">UI设计</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2018-06-05-border-sizing/" class="nav-link">CSS3</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-17-why-i-stopped-using-sass/" class="nav-link">SCSS</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-07-16-font-animation/" class="nav-link">动画设计</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-09-09-mysql-blog-ui/" class="nav-link">项目实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">算法修炼</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>算法和数据结构</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2019-06-23-algorithm-offer/" class="nav-link">JS版·剑指offer</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-10-23-singleton-pattern/" class="nav-link">创建型模式</a></li><li class="dropdown-subitem"><a href="/passages/2018-12-16-flyweight-pattern/" class="nav-link">结构型模式</a></li><li class="dropdown-subitem"><a href="/passages/2018-11-25-command-pattern/" class="nav-link">行为型模式</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">随手记</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-10-weekly-share/" class="nav-link">每周分享</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-09-06-git-tag-and-version/" class="nav-link">Git手册</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/together/" class="nav-link">参与协作</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">网站信息</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-07-12-redis-cache-question/" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">en-US</a></li></ul></div></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/passages/2019-06-10-weekly-share/" class="sidebar-link">专题介绍</a></li><li><a href="/passages/2019-07-12-redis-cache-question/" class="active sidebar-link">redis热key,缓存穿透,击穿,集群等问题研究</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#主从模式" class="sidebar-link">主从模式</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#哨兵" class="sidebar-link">哨兵</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#穿透" class="sidebar-link">穿透</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#雪崩" class="sidebar-link">雪崩</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#击穿" class="sidebar-link">击穿</a></li></ul></li><li><a href="/passages/2019-07-06-half-year/" class="sidebar-link">无声半年：面试、实习和生活总结</a></li><li><a href="/passages/2019-05-25-learn-to-learn/" class="sidebar-link">如何缩小学习反馈周期</a></li><li><a href="/passages/2019-03-15-weekly-share-3/" class="sidebar-link">2019初刊</a></li><li><a href="/passages/2018-12-24-weekly-share-2/" class="sidebar-link">2018·第二期</a></li><li><a href="/passages/2018-12-08-weekly-share-1/" class="sidebar-link">2018·第一期</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>本篇由来自 <strong>字节跳动</strong> 的 <a href="https://github.com/HuangHongkai" target="_blank" rel="noopener noreferrer">Hongkai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 分享。</p></blockquote> <p>Redis 主要用途有 2 个</p> <ul><li>数据缓存，减轻 db 的压力</li> <li>数据同步，在分布式系统中各个实例的信息同步</li></ul> <p>redis 的 QPS 量通常相当的大，动辄百万 QPS，一般企业都需要很庞大的 redis 集群资源。由于 redis 的使用相当频繁，经常会出现各种问题。根据目前积累的线上经验，redis 出现问题第一步就是要想到：<strong>redis 是单进程单线程实例</strong> 理解这一点通常能解决很多问题。</p> <p>下面介绍一些 redis 的一些理论知识。</p> <h2 id="主从模式"><a href="#主从模式" aria-hidden="true" class="header-anchor">#</a> 主从模式</h2> <p>将数据分散到多个服务器上，每个服务拥有同样的样本，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。为此， Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。</p> <h3 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <p>在 redis 或 mysql 等数据库中，数据库分为两类，一类是主数据库（master），另一类是从数据库（slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，并接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。</p> <h3 id="复制原理"><a href="#复制原理" aria-hidden="true" class="header-anchor">#</a> 复制原理</h3> <p>当从数据库启动时，会向主数据库发送 sync 命令，主数据库接收到 sync 后开始在后台保存快照 rdb，在保存快照期间受到的命名缓存起来，当快照完成时，主数据库会将快照和缓存的命令一块发送给从。复制初始化结束。之后，主每接收到 1 个命令就同步发送给从。 当出现断开重连后，2.8 之后的版本会将断线期间的命令传给从数据库。</p> <h3 id="优点："><a href="#优点：" aria-hidden="true" class="header-anchor">#</a> 优点：</h3> <ul><li><p>减轻单点压力</p></li> <li><p>提升系统容灾能力</p></li></ul> <h3 id="缺点："><a href="#缺点：" aria-hidden="true" class="header-anchor">#</a> 缺点：</h3> <ul><li>承载的容量非常有限，假设服务器的内存都是 40G，有 10 台服务器，意味着只能容纳 40G 的数据。</li> <li>刚写入的数据可能获取不到（因为数据还没有更新到其他服务器上）</li></ul> <h2 id="哨兵"><a href="#哨兵" aria-hidden="true" class="header-anchor">#</a> 哨兵</h2> <p>在主从模式下，当主服务出现异常会导致整体 redis 不可写。开发者需要手动将一个从数据库升级为主数据库保证服务正常运行。该过程难以自动后，为此在 redis2.8 后提供了哨兵来实现故障恢复功能。</p> <p>哨兵就是 redis 的监控系统，包括 2 个功能</p> <ul><li>监控主数据库和从数据库是否正常运行。</li> <li>主数据库出现故障时自动将从数据库转换为主数据库。</li></ul> <h3 id="主从切换过程"><a href="#主从切换过程" aria-hidden="true" class="header-anchor">#</a> 主从切换过程</h3> <ul><li>slave leader 升级为 master</li> <li>其他 slave 修改为新 master 的 slave</li> <li>客户端修改连接</li> <li>老的 master 如果重启成功，变为新 master 的 slave</li></ul> <h3 id="集群"><a href="#集群" aria-hidden="true" class="header-anchor">#</a> 集群</h3> <p>使用哨兵，redis 每个实例也是全量存储，每个 redis 存储的内容都是完整的数据，浪费内存且有木桶效应。为了最大化利用内存，可以采用集群，即每台机器存储不同的内容。</p> <p>简单来讲：通过不断的扩容和增加运行 redis 实例的机器数量，使得 redis 能撑得住更大的访问量</p> <h3 id="原理"><a href="#原理" aria-hidden="true" class="header-anchor">#</a> 原理</h3> <p>redis cluster 中有一个 16384（2^4 * 2^10）长度的槽的概念。通过哈希算法再加上取模运算可以将一个值固定地映射到某个区间，区间由连续的 slot 组成。</p> <p>redis cluster 采用虚拟槽分区，所有的键根据哈希函数(CRC16[key]&amp;16383)映射到 0－16383 槽内，共 16384 个槽位，每个节点维护部分槽及槽所映射的键值数据，可以为节点设置权重，权重高的节点维护的槽的数量比较多。</p> <p>哈希函数: Hash()=CRC16[key]&amp;16383 按位与</p> <p>redis 用虚拟槽分区原因：解耦数据与节点关系，节点自身维护槽映射关系，分布式存储</p> <h3 id="集群模式"><a href="#集群模式" aria-hidden="true" class="header-anchor">#</a> 集群模式</h3> <ul><li>客户端模式</li></ul> <p>在客户端做 redis 负载均衡，通过服务发现注册 redis 节点，实现 redis 节点的动态改变（增删或者节点扩容）</p> <p><img src="https://i.loli.net/2019/07/12/5d27764947bf559054.png" alt="img"></p> <p>优点</p> <ul><li>数据分散，使得整体容量得到提升</li> <li>当一个节点不可用不会导致整体服务不可用</li> <li>性能高，客户端直接连接 redis，不通过代理</li> <li>扩容方便</li></ul> <p>目前企业使用的 redis 集群基本都是客户端模式，这样可以减轻服务端的压力。</p> <ul><li>代理模式</li></ul> <p>客户端不是直接连接 redis，而是连接代理，这样子客户端的开发就变得简单很多了。。同时服务端也可以控制 redis 的连接数。</p> <p><img src="https://i.loli.net/2019/07/12/5d27764e1a87934952.png" alt="img"></p> <h3 id="分析"><a href="#分析" aria-hidden="true" class="header-anchor">#</a> 分析</h3> <p>集群模式的解决了容量的问题，但是带来了很多的问题，例如 redis 的热 key 问题，单点高并发会导致 redis 负载及其不均衡，进而服务可用性极低。</p> <h2 id="穿透"><a href="#穿透" aria-hidden="true" class="header-anchor">#</a> 穿透</h2> <h3 id="缓存的处理流程"><a href="#缓存的处理流程" aria-hidden="true" class="header-anchor">#</a> 缓存的处理流程</h3> <p><img src="https://i.loli.net/2019/07/12/5d277651adee639077.png" alt="img"></p> <h3 id="缓存穿透"><a href="#缓存穿透" aria-hidden="true" class="header-anchor">#</a> 缓存穿透</h3> <p>频繁查询一个不存在的数据，由于缓存不命中，每次都要查询持久层。从而失去缓存的意义。</p> <p>如果恶意用户知道我们 redis key 的构造规则，每次故意查询一个在缓存内必然不存在的数据，导致每次请求都要去存储层去查询，这样缓存就失去了意义。如果在高并发下数据库可能挂掉。这就是<strong>缓存击穿</strong>。</p> <h2 id="雪崩"><a href="#雪崩" aria-hidden="true" class="header-anchor">#</a> 雪崩</h2> <p>redis 缓存大量失效的时候，引发大量查询数据库。如果有的数据只放在 redis 上（例如用来同步多个服务实例信息之间的共享数据），redis 缓存失效会导致服务出现异常，这比查数据库更加严重</p> <p>引起这个问题的原因主要是 redis 单点被打垮，也就是热 key 问题。</p> <h2 id="击穿"><a href="#击穿" aria-hidden="true" class="header-anchor">#</a> 击穿</h2> <p>缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力</p> <p>解决方案：</p> <ul><li>设置频繁访问的数据过期（让缓存持续命中）</li> <li>加分布式锁（如果缓存不存在，只让一个进程去读 db，有点类似于单例模式的实现，下面是一个从网上找的小 demo）</li></ul> <p><img src="https://i.loli.net/2019/07/12/5d277650ad21c42141.png" alt="img"></p> <h3 id="热-key"><a href="#热-key" aria-hidden="true" class="header-anchor">#</a> 热 key</h3> <p>在集群模式下经常会遇到这个问题，业界依然没有好的解决方案（参见微博只要热点事件就垮了）</p> <p>热 key：某个 key 访问非常的频繁，<strong>redis 集群负载不均衡，导致单点延迟增加，从而导致单点 redis 上的缓存不可用。</strong></p> <p>这个问题相当的难以解决，微博在出现热点事件后服务不可用，很大原因是热 key 问题，导致单点 redis 被打垮了， 增加 db 访问量，进而系统雪崩。</p> <p>因为<strong>redis 是单进程单线程</strong> ，redis 的处理线程忙起来，会导致 redis 没空 accept 来自 client 的 tcp 请求，进而出现连接超时的错误，缓存未命中。</p> <h3 id="解决方案"><a href="#解决方案" aria-hidden="true" class="header-anchor">#</a> 解决方案</h3> <p>没有具体的解决方案，需要根据业务来制定。思路<strong>将 key 打散</strong>，就是将 redis 访问某个热 key，转化为访问多个 key，减轻单点压力</p> <p>但并不是所有的业务都能使用该解决方案。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dongyuanxin/blog/edit/master/每周分享/2019/04-redis热key等问题研究.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新于: </span> <span class="time">7/12/2019, 5:10:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/passages/2019-06-10-weekly-share/" class="prev">
          专题介绍
        </a></span> <span class="next"><a href="/passages/2019-07-06-half-year/">
          无声半年：面试、实习和生活总结
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><div class="my-loader center" style="display:none;" data-v-354e1a9e><div class="my-loader-circle" data-v-354e1a9e></div></div><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div><!----><!----><div></div></div></div>
    <script src="/assets/js/app.11f385e3.js" defer></script><script src="/assets/js/2.f7ad212a.js" defer></script><script src="/assets/js/128.00be12cd.js" defer></script><script src="/assets/js/4.6e2c4845.js" defer></script>
  </body>
</html>
